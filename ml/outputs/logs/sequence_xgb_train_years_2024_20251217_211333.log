2025-12-17 21:13:33 - ml.src.pipeline_config_extended - INFO - Pipeline configuration validated successfully
2025-12-17 21:13:33 - __main__ - INFO - 
================================================================================
2025-12-17 21:13:33 - __main__ - INFO - SEQUENCE XGBoost TRAINING PIPELINE - XAU/USD 1-Minute Data
2025-12-17 21:13:33 - __main__ - INFO - ================================================================================
2025-12-17 21:13:33 - __main__ - INFO - Log file: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\logs\sequence_xgb_train_years_2024_20251217_211333.log
2025-12-17 21:13:33 - __main__ - INFO - Start time: 2025-12-17 21:13:33
2025-12-17 21:13:33 - __main__ - INFO - Data years: [2024]
2025-12-17 21:13:33 - __main__ - INFO - 
Pipeline Configuration:
2025-12-17 21:13:33 - __main__ - INFO -   Feature engineering version: v1
2025-12-17 21:13:33 - __main__ - INFO -   Window size: 160 candles
2025-12-17 21:13:33 - __main__ - INFO -   ATR SL multiplier: 0.1x (OPTION B optimized)
2025-12-17 21:13:33 - __main__ - INFO -   ATR TP multiplier: 0.2x (OPTION B optimized)
2025-12-17 21:13:33 - __main__ - INFO -   Min hold time: 5 minutes
2025-12-17 21:13:33 - __main__ - INFO -   Max horizon: 60 candles
2025-12-17 21:13:33 - __main__ - INFO -   Trading session: london_ny
2025-12-17 21:13:33 - __main__ - INFO -   Min precision threshold: 0.85
2025-12-17 21:13:33 - __main__ - INFO -   M5 alignment filter: enabled
2025-12-17 21:13:33 - __main__ - INFO -   Trend filter: enabled
2025-12-17 21:13:33 - __main__ - INFO -   Pullback filter: enabled
2025-12-17 21:13:33 - __main__ - INFO -   Random state: 42
2025-12-17 21:13:33 - __main__ - INFO - ================================================================================

2025-12-17 21:13:33 - ml.src.pipeline_stages - INFO - Loading data from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 21:13:33 - ml.src.data_loading.loaders - INFO - Year filter applied: loading only [2024]
2025-12-17 21:13:33 - ml.src.pipeline_stages - INFO - Loaded 355,661 rows from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 21:13:33 - ml.src.pipeline_stages - INFO - Date range: 2024-01-02 01:00:00 to 2024-12-31 23:46:00
2025-12-17 21:13:33 - ml.src.pipeline_stages - WARNING - window_size parameter is deprecated and ignored (passed: 160)
2025-12-17 21:13:33 - ml.src.pipeline_stages - WARNING - feature_version parameter is deprecated and ignored (passed: v1)
2025-12-17 21:13:33 - ml.src.pipeline_stages - INFO - Engineering technical features (multi-timeframe)...
2025-12-17 21:13:33 - ml.src.features.engineer - INFO - Engineering features for 355,661 candles (Multi-Timeframe Focus)...
2025-12-17 21:13:33 - ml.src.features.engineer - INFO - Computing M5 features using proper resample aggregation...
2025-12-17 21:13:33 - ml.src.features.engineer - INFO - Computing M15 features using proper resample aggregation...
2025-12-17 21:13:33 - ml.src.features.engineer - INFO - Computing M60 features using proper resample aggregation...
2025-12-17 21:13:34 - ml.src.features.engineer - INFO - Feature engineering complete: 355661 rows × 15 features
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Features shape: (355661, 15)
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Feature columns: 15
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Creating targets (SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60)
2025-12-17 21:13:34 - ml.src.targets.target_maker - INFO - Creating targets (SL/TP simulation) for 355,661 candles...
2025-12-17 21:13:34 - ml.src.targets.target_maker - INFO - Parameters: SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60min
2025-12-17 21:13:34 - ml.src.targets.target_maker - INFO - Calculating M1 ATR(14) for SL/TP targets (fallback)
2025-12-17 21:13:34 - ml.src.targets.target_maker - INFO - Target creation complete: 355,601 valid targets
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Targets shape: 355601
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Positive class (win): 207,791 (58.43%)
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Negative class (loss): 147,810 (41.57%)
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Creating sequences (window_size=160)...
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Filter config: m5=True, trend=True, pullback=True, max_windows=1,000
2025-12-17 21:13:34 - ml.src.sequences.sequencer - INFO - Applied M5 alignment filter (keeping only candles ending at 4, 9, 14... to trade at 0, 5, 10...)
2025-12-17 21:13:34 - ml.src.sequences.sequencer - WARNING - dist_sma_200 or adx feature not found; skipping trend filter
2025-12-17 21:13:34 - ml.src.sequences.sequencer - INFO - Applied Pullback Filter (RSI_M5 < 75.00): kept 301992/355442 (85.0%)
2025-12-17 21:13:34 - ml.src.sequences.sequencer - INFO - Session filter 'london_ny': keeping 39,067 / 355,442 windows (11.0%)
2025-12-17 21:13:34 - ml.src.sequences.sequencer - WARNING - Too many windows (39,067) for memory safety. Capping to last 1,000 windows.
2025-12-17 21:13:34 - ml.src.sequences.sequencer - INFO - After capping: 1,000 windows
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Sequences created: X.shape=(1000, 2400), y.shape=(1000,)
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Positive class in sequences: 578 (57.80%)
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Splitting data chronologically (train/val/test)...
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Using percentage split (70/15/15) for year_filter=[2024]
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Split sizes: train=700, val=150, test=150
2025-12-17 21:13:34 - ml.src.pipeline_stages - INFO - Scaling features with RobustScaler (robust to outliers)...
2025-12-17 21:13:35 - ml.src.pipeline_stages - INFO - Feature scaling complete: mean=-0.3840, std=4.9855
2025-12-17 21:13:35 - ml.src.pipeline_stages - INFO - Training XGBoost classifier...
2025-12-17 21:13:35 - ml.src.training.sequence_xgb_trainer - INFO - Class balance (train): pos=398, neg=302, imbalance_ratio=0.76
2025-12-17 21:13:35 - ml.src.training.sequence_xgb_trainer - INFO - Applied scale_pos_weight=0.7588 to handle class imbalance
2025-12-17 21:13:35 - ml.src.training.sequence_xgb_trainer - INFO - Training XGBoost classifier...
2025-12-17 21:13:51 - ml.src.training.sequence_xgb_trainer - INFO - Training completed
2025-12-17 21:13:51 - ml.src.pipeline_stages - INFO - Evaluating model on test set...
2025-12-17 21:13:51 - ml.src.training.sequence_evaluation - INFO - Probability stats: min=0.1417, max=0.8569, mean=0.5553, std=0.1817
2025-12-17 21:13:51 - ml.src.training.sequence_evaluation - WARNING - No threshold met precision >= 0.85 with >= 25 trades. Falling back to maximizing precision with stability constraint.
2025-12-17 21:13:51 - ml.src.training.sequence_evaluation - INFO - Confusion matrix@thr=0.74:
2025-12-17 21:13:51 - ml.src.training.sequence_evaluation - INFO -   [[TN=55, FP=5],
2025-12-17 21:13:51 - ml.src.training.sequence_evaluation - INFO -    [FN=70, TP=20]]
2025-12-17 21:13:51 - ml.src.pipeline_stages - INFO - Evaluation metrics: threshold=0.74, win_rate=0.8000 (80.00%), precision=0.8000, recall=0.2222, f1=0.3478, roc_auc=0.6569, pr_auc=0.7371
2025-12-17 21:13:51 - ml.src.pipeline_stages - INFO - Saving artifacts...
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Saved model to sequence_xgb_model.pkl
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Saved scaler to sequence_scaler.pkl (required for inference)
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Saved feature columns to sequence_feature_columns.json
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Saved metadata to sequence_threshold.json
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Analyzing feature importance...
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO - 
Top 30 most important features:
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    1. t-1_bb_pos_m15                           = 0.003407
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    2. t-3_bb_pos_m15                           = 0.003124
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    3. t-3_dist_sma_20_m5                       = 0.003074
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    4. t-131_bb_pos_m15                         = 0.002901
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    5. t-138_bb_pos_m15                         = 0.002845
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    6. t-4_rsi_m60                              = 0.002728
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    7. t-0_dist_sma_20                          = 0.002689
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    8. t-53_rsi_14                              = 0.002660
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -    9. t-89_bb_pos_m60                          = 0.002629
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   10. t-19_bb_pos_m60                          = 0.002596
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   11. t-2_bb_pos_m15                           = 0.002576
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   12. t-4_dist_sma_20_m15                      = 0.002515
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   13. t-99_macd_hist_m5                        = 0.002455
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   14. t-77_stoch_k_m5                          = 0.002400
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   15. t-95_bb_pos_m15                          = 0.002352
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   16. t-55_bb_pos_m15                          = 0.002210
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   17. t-29_dist_sma_20_m15                     = 0.002188
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   18. t-151_atr_14                             = 0.002176
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   19. t-54_dist_sma_20_m5                      = 0.002160
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   20. t-28_macd_hist_m5                        = 0.002154
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   21. t-24_dist_sma_20_m15                     = 0.002117
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   22. t-27_rsi_m5                              = 0.002108
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   23. t-69_rsi_14                              = 0.002092
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   24. t-72_rsi_14                              = 0.002089
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   25. t-6_dist_sma_20_m5                       = 0.002054
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   26. t-9_bb_pos_m15                           = 0.002053
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   27. t-1_dist_sma_20                          = 0.002038
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   28. t-3_macd_hist_m5                         = 0.002038
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   29. t-44_bb_pos_m60                          = 0.002032
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   30. t-26_bb_position                         = 0.002020
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO - 
Aggregated importance by feature type:
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   ret_1                          = 0.108115
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   rsi_14                         = 0.099988
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   macd_hist_m5                   = 0.098115
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   bb_position                    = 0.096928
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20                    = 0.087409
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20_m15                = 0.078729
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   bb_pos_m5                      = 0.069796
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   bb_pos_m15                     = 0.068588
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   atr_14                         = 0.067464
2025-12-17 21:13:51 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20_m5                 = 0.066605
2025-12-17 21:13:51 - ml.src.training.sequence_artifacts - INFO - Saved feature importance to sequence_feature_importance.json
2025-12-17 21:13:51 - ml.src.pipeline_stages - INFO - Artifacts saved to C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 21:13:51 - __main__ - INFO - 
================================================================================
2025-12-17 21:13:51 - __main__ - INFO - TRAINING COMPLETE - SUMMARY
2025-12-17 21:13:51 - __main__ - INFO - ================================================================================
2025-12-17 21:13:51 - __main__ - INFO - End time: 2025-12-17 21:13:51
2025-12-17 21:13:51 - __main__ - INFO - 
Final Metrics:
2025-12-17 21:13:51 - __main__ - INFO -   Window Size:       160 candles
2025-12-17 21:13:51 - __main__ - INFO -   Threshold:         0.7400
2025-12-17 21:13:51 - __main__ - INFO -   WIN RATE:          0.8000 (80.00%)
2025-12-17 21:13:51 - __main__ - INFO -   Precision:         0.8000
2025-12-17 21:13:51 - __main__ - INFO -   Recall:            0.2222
2025-12-17 21:13:51 - __main__ - INFO -   F1 Score:          0.3478
2025-12-17 21:13:51 - __main__ - INFO -   ROC-AUC:           0.6569
2025-12-17 21:13:51 - __main__ - INFO -   PR-AUC:            0.7371
2025-12-17 21:13:51 - __main__ - INFO - 
Artifacts saved to: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 21:13:51 - __main__ - INFO - ================================================================================
