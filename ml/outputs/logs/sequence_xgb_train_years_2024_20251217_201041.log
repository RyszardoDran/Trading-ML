2025-12-17 20:10:41 - ml.src.pipeline_config_extended - INFO - Pipeline configuration validated successfully
2025-12-17 20:10:41 - __main__ - INFO - 
================================================================================
2025-12-17 20:10:41 - __main__ - INFO - SEQUENCE XGBoost TRAINING PIPELINE - XAU/USD 1-Minute Data
2025-12-17 20:10:41 - __main__ - INFO - ================================================================================
2025-12-17 20:10:41 - __main__ - INFO - Log file: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\logs\sequence_xgb_train_years_2024_20251217_201041.log
2025-12-17 20:10:41 - __main__ - INFO - Start time: 2025-12-17 20:10:41
2025-12-17 20:10:41 - __main__ - INFO - Data years: [2024]
2025-12-17 20:10:41 - __main__ - INFO - 
Pipeline Configuration:
2025-12-17 20:10:41 - __main__ - INFO -   Feature engineering version: v1
2025-12-17 20:10:41 - __main__ - INFO -   Window size: 60 candles
2025-12-17 20:10:41 - __main__ - INFO -   ATR SL multiplier: 0.1x (OPTION B optimized)
2025-12-17 20:10:41 - __main__ - INFO -   ATR TP multiplier: 0.2x (OPTION B optimized)
2025-12-17 20:10:41 - __main__ - INFO -   Min hold time: 5 minutes
2025-12-17 20:10:41 - __main__ - INFO -   Max horizon: 60 candles
2025-12-17 20:10:41 - __main__ - INFO -   Trading session: london
2025-12-17 20:10:41 - __main__ - INFO -   Min precision threshold: 0.85
2025-12-17 20:10:41 - __main__ - INFO -   M5 alignment filter: enabled
2025-12-17 20:10:41 - __main__ - INFO -   Trend filter: enabled
2025-12-17 20:10:41 - __main__ - INFO -   Pullback filter: enabled
2025-12-17 20:10:41 - __main__ - INFO -   Random state: 42
2025-12-17 20:10:41 - __main__ - INFO - ================================================================================

2025-12-17 20:10:41 - ml.src.pipeline_stages - INFO - Loading data from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 20:10:41 - ml.src.data_loading.loaders - INFO - Year filter applied: loading only [2024]
2025-12-17 20:10:42 - ml.src.pipeline_stages - INFO - Loaded 355,661 rows from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 20:10:42 - ml.src.pipeline_stages - INFO - Date range: 2024-01-02 01:00:00 to 2024-12-31 23:46:00
2025-12-17 20:10:42 - ml.src.pipeline_stages - INFO - Engineering technical features (version=v1, window_size=60)...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Engineering features for 355,661 candles...
2025-12-17 20:10:42 - ml.src.features.m5_context - INFO - Computing M5 context features...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating basic price features...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating candle structure...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating volume changes...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating technical indicators...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating momentum indicators...
2025-12-17 20:10:42 - ml.src.features.engineer - INFO - Calculating volume indicators...
2025-12-17 20:10:42 - ml.src.features.time_features - INFO - Computing time-based features...
2025-12-17 20:10:43 - ml.src.features.engineer - INFO - Calculating micro-structure features...
2025-12-17 20:10:43 - ml.src.features.engineer - INFO - Creating features DataFrame...
2025-12-17 20:10:44 - ml.src.features.engineer - INFO - Feature engineering complete: 355661 rows × 57 features
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Features shape: (355661, 57)
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Feature columns: 57
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Creating targets (SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60)
2025-12-17 20:10:44 - ml.src.targets.target_maker - INFO - Creating targets (SL/TP simulation) for 355,661 candles...
2025-12-17 20:10:44 - ml.src.targets.target_maker - INFO - Parameters: SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60min
2025-12-17 20:10:44 - ml.src.targets.target_maker - INFO - Using pre-calculated M5 ATR for SL/TP targets
2025-12-17 20:10:44 - ml.src.targets.target_maker - INFO - Target creation complete: 355,601 valid targets
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Targets shape: 355601
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Positive class (win): 182,294 (51.26%)
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Negative class (loss): 173,307 (48.74%)
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Creating sequences (window_size=60)...
2025-12-17 20:10:44 - ml.src.pipeline_stages - INFO - Filter config: m5=True, trend=True, pullback=True, max_windows=50,000
2025-12-17 20:10:44 - ml.src.sequences.sequencer - INFO - Applied M5 alignment filter (keeping only candles ending at 4, 9, 14... to trade at 0, 5, 10...)
2025-12-17 20:10:44 - ml.src.sequences.sequencer - INFO - Applied Trend Filter (dist_sma_200 > 0.00, ADX > 15.00): kept 178138/355542 (50.1%)
2025-12-17 20:10:44 - ml.src.sequences.sequencer - INFO - Applied Pullback Filter (RSI_M5 < 75.00): kept 330757/355542 (93.0%)
2025-12-17 20:10:44 - ml.src.sequences.sequencer - INFO - Session filter 'london': keeping 10,790 / 355,542 windows (3.0%)
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Sequences created: X.shape=(10790, 3420), y.shape=(10790,)
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Positive class in sequences: 5,549 (51.43%)
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Splitting data chronologically (train/val/test)...
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Using percentage split (70/15/15) for year_filter=[2024]
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Split sizes: train=7,552, val=1,619, test=1,619
2025-12-17 20:10:45 - ml.src.pipeline_stages - INFO - Scaling features with RobustScaler (robust to outliers)...
2025-12-17 20:10:47 - ml.src.pipeline_stages - INFO - Feature scaling complete: mean=0.0542, std=9.2224
2025-12-17 20:10:47 - ml.src.pipeline_stages - INFO - Training XGBoost classifier...
2025-12-17 20:10:47 - ml.src.training.sequence_xgb_trainer - INFO - Class balance (train): pos=3,858, neg=3,694, imbalance_ratio=0.96
2025-12-17 20:10:47 - ml.src.training.sequence_xgb_trainer - INFO - Applied scale_pos_weight=0.9575 to handle class imbalance
2025-12-17 20:10:47 - ml.src.training.sequence_xgb_trainer - INFO - Training XGBoost classifier...
2025-12-17 20:11:14 - ml.src.training.sequence_xgb_trainer - INFO - Training completed
2025-12-17 20:11:14 - ml.src.pipeline_stages - INFO - Evaluating model on test set...
2025-12-17 20:11:14 - ml.src.training.sequence_evaluation - INFO - Probability stats: min=0.4359, max=0.5476, mean=0.4982, std=0.0174
2025-12-17 20:11:14 - ml.src.training.sequence_evaluation - WARNING - ⚠️  Model has very low discriminative power (ROC-AUC=0.5200). Results may be random.
2025-12-17 20:11:14 - ml.src.training.sequence_evaluation - WARNING - No threshold met precision >= 0.85 with >= 25 trades. Falling back to maximizing precision with stability constraint.
2025-12-17 20:11:15 - ml.src.training.sequence_evaluation - INFO - Confusion matrix@thr=0.53:
2025-12-17 20:11:15 - ml.src.training.sequence_evaluation - INFO -   [[TN=777, FP=12],
2025-12-17 20:11:15 - ml.src.training.sequence_evaluation - INFO -    [FN=802, TP=28]]
2025-12-17 20:11:15 - ml.src.pipeline_stages - INFO - Evaluation metrics: threshold=0.53, win_rate=0.7000 (70.00%), precision=0.7000, recall=0.0337, f1=0.0644, roc_auc=0.5200, pr_auc=0.5365
2025-12-17 20:11:15 - ml.src.pipeline_stages - INFO - Saving artifacts...
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Saved model to sequence_xgb_model.pkl
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Saved scaler to sequence_scaler.pkl (required for inference)
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Saved feature columns to sequence_feature_columns.json
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Saved metadata to sequence_threshold.json
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Analyzing feature importance...
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO - 
Top 30 most important features:
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    1. t-24_distance_from_ma                    = 0.001483
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    2. t-7_vol_20                               = 0.001387
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    3. t-0_ema_spread_n                         = 0.001316
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    4. t-48_lower_shadow                        = 0.001278
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    5. t-8_bb_width                             = 0.001221
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    6. t-37_obv_normalized                      = 0.001199
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    7. t-21_roc_20                              = 0.001197
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    8. t-32_stoch_d                             = 0.001195
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -    9. t-18_adx                                 = 0.001182
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   10. t-42_bb_position                         = 0.001177
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   11. t-27_z_score_20                          = 0.001169
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   12. t-39_bb_width                            = 0.001159
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   13. t-26_obv_normalized                      = 0.001147
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   14. t-1_roc_5                                = 0.001138
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   15. t-55_adx                                 = 0.001135
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   16. t-0_dist_sma_200                         = 0.001129
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   17. t-44_adx                                 = 0.001126
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   18. t-48_rsi_m5                              = 0.001125
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   19. t-33_roc_5                               = 0.001121
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   20. t-52_atr_n                               = 0.001120
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   21. t-33_slope_60                            = 0.001112
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   22. t-22_ret_1                               = 0.001108
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   23. t-51_micro_vol_5                         = 0.001108
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   24. t-0_bb_width                             = 0.001105
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   25. t-45_atr_n                               = 0.001103
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   26. t-20_distance_from_ma                    = 0.001099
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   27. t-43_price_position                      = 0.001095
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   28. t-22_macd_hist_n                         = 0.001094
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   29. t-10_z_score_20                          = 0.001093
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   30. t-26_z_score_20                          = 0.001090
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO - 
Aggregated importance by feature type:
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   upper_shadow                   = 0.038594
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   fractal_dim_5                  = 0.037633
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   vol_change                     = 0.037244
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   vol_ratio_5_20                 = 0.036339
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   body_ratio                     = 0.036236
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   lower_shadow                   = 0.035940
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   ret_1                          = 0.034772
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   vol_ratio                      = 0.033749
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   efficiency_5                   = 0.032559
2025-12-17 20:11:15 - ml.src.training.sequence_feature_analysis - INFO -   range_n                        = 0.030873
2025-12-17 20:11:15 - ml.src.training.sequence_artifacts - INFO - Saved feature importance to sequence_feature_importance.json
2025-12-17 20:11:15 - ml.src.pipeline_stages - INFO - Artifacts saved to C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 20:11:15 - __main__ - INFO - 
================================================================================
2025-12-17 20:11:15 - __main__ - INFO - TRAINING COMPLETE - SUMMARY
2025-12-17 20:11:15 - __main__ - INFO - ================================================================================
2025-12-17 20:11:15 - __main__ - INFO - End time: 2025-12-17 20:11:15
2025-12-17 20:11:15 - __main__ - INFO - 
Final Metrics:
2025-12-17 20:11:15 - __main__ - INFO -   Window Size:       60 candles
2025-12-17 20:11:15 - __main__ - INFO -   Threshold:         0.5300
2025-12-17 20:11:15 - __main__ - INFO -   WIN RATE:          0.7000 (70.00%)
2025-12-17 20:11:15 - __main__ - INFO -   Precision:         0.7000
2025-12-17 20:11:15 - __main__ - INFO -   Recall:            0.0337
2025-12-17 20:11:15 - __main__ - INFO -   F1 Score:          0.0644
2025-12-17 20:11:15 - __main__ - INFO -   ROC-AUC:           0.5200
2025-12-17 20:11:15 - __main__ - INFO -   PR-AUC:            0.5365
2025-12-17 20:11:15 - __main__ - INFO - 
Artifacts saved to: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 20:11:15 - __main__ - INFO - ================================================================================
