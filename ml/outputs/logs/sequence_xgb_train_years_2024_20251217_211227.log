2025-12-17 21:12:27 - ml.src.pipeline_config_extended - INFO - Pipeline configuration validated successfully
2025-12-17 21:12:27 - __main__ - INFO - 
================================================================================
2025-12-17 21:12:27 - __main__ - INFO - SEQUENCE XGBoost TRAINING PIPELINE - XAU/USD 1-Minute Data
2025-12-17 21:12:27 - __main__ - INFO - ================================================================================
2025-12-17 21:12:27 - __main__ - INFO - Log file: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\logs\sequence_xgb_train_years_2024_20251217_211227.log
2025-12-17 21:12:27 - __main__ - INFO - Start time: 2025-12-17 21:12:27
2025-12-17 21:12:27 - __main__ - INFO - Data years: [2024]
2025-12-17 21:12:27 - __main__ - INFO - 
Pipeline Configuration:
2025-12-17 21:12:27 - __main__ - INFO -   Feature engineering version: v1
2025-12-17 21:12:27 - __main__ - INFO -   Window size: 60 candles
2025-12-17 21:12:27 - __main__ - INFO -   ATR SL multiplier: 0.1x (OPTION B optimized)
2025-12-17 21:12:27 - __main__ - INFO -   ATR TP multiplier: 0.2x (OPTION B optimized)
2025-12-17 21:12:27 - __main__ - INFO -   Min hold time: 5 minutes
2025-12-17 21:12:27 - __main__ - INFO -   Max horizon: 60 candles
2025-12-17 21:12:27 - __main__ - INFO -   Trading session: london_ny
2025-12-17 21:12:27 - __main__ - INFO -   Min precision threshold: 0.85
2025-12-17 21:12:27 - __main__ - INFO -   M5 alignment filter: enabled
2025-12-17 21:12:27 - __main__ - INFO -   Trend filter: enabled
2025-12-17 21:12:27 - __main__ - INFO -   Pullback filter: enabled
2025-12-17 21:12:27 - __main__ - INFO -   Random state: 42
2025-12-17 21:12:27 - __main__ - INFO - ================================================================================

2025-12-17 21:12:27 - ml.src.pipeline_stages - INFO - Loading data from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 21:12:27 - ml.src.data_loading.loaders - INFO - Year filter applied: loading only [2024]
2025-12-17 21:12:28 - ml.src.pipeline_stages - INFO - Loaded 355,661 rows from C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\src\data
2025-12-17 21:12:28 - ml.src.pipeline_stages - INFO - Date range: 2024-01-02 01:00:00 to 2024-12-31 23:46:00
2025-12-17 21:12:28 - ml.src.pipeline_stages - WARNING - feature_version parameter is deprecated and ignored (passed: v1)
2025-12-17 21:12:28 - ml.src.pipeline_stages - INFO - Engineering technical features (multi-timeframe)...
2025-12-17 21:12:28 - ml.src.features.engineer - INFO - Engineering features for 355,661 candles (Multi-Timeframe Focus)...
2025-12-17 21:12:28 - ml.src.features.engineer - INFO - Computing M5 features using proper resample aggregation...
2025-12-17 21:12:28 - ml.src.features.engineer - INFO - Computing M15 features using proper resample aggregation...
2025-12-17 21:12:28 - ml.src.features.engineer - INFO - Computing M60 features using proper resample aggregation...
2025-12-17 21:12:29 - ml.src.features.engineer - INFO - Feature engineering complete: 355661 rows × 15 features
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Features shape: (355661, 15)
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Feature columns: 15
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Creating targets (SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60)
2025-12-17 21:12:29 - ml.src.targets.target_maker - INFO - Creating targets (SL/TP simulation) for 355,661 candles...
2025-12-17 21:12:29 - ml.src.targets.target_maker - INFO - Parameters: SL=0.1×ATR, TP=0.2×ATR, min_hold=5min, max_horizon=60min
2025-12-17 21:12:29 - ml.src.targets.target_maker - INFO - Calculating M1 ATR(14) for SL/TP targets (fallback)
2025-12-17 21:12:29 - ml.src.targets.target_maker - INFO - Target creation complete: 355,601 valid targets
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Targets shape: 355601
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Positive class (win): 207,791 (58.43%)
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Negative class (loss): 147,810 (41.57%)
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Creating sequences (window_size=60)...
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Filter config: m5=True, trend=True, pullback=True, max_windows=1,000
2025-12-17 21:12:29 - ml.src.sequences.sequencer - INFO - Applied M5 alignment filter (keeping only candles ending at 4, 9, 14... to trade at 0, 5, 10...)
2025-12-17 21:12:29 - ml.src.sequences.sequencer - WARNING - dist_sma_200 or adx feature not found; skipping trend filter
2025-12-17 21:12:29 - ml.src.sequences.sequencer - INFO - Applied Pullback Filter (RSI_M5 < 75.00): kept 302054/355542 (85.0%)
2025-12-17 21:12:29 - ml.src.sequences.sequencer - INFO - Session filter 'london_ny': keeping 39,067 / 355,542 windows (11.0%)
2025-12-17 21:12:29 - ml.src.sequences.sequencer - WARNING - Too many windows (39,067) for memory safety. Capping to last 1,000 windows.
2025-12-17 21:12:29 - ml.src.sequences.sequencer - INFO - After capping: 1,000 windows
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Sequences created: X.shape=(1000, 900), y.shape=(1000,)
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Positive class in sequences: 578 (57.80%)
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Splitting data chronologically (train/val/test)...
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Using percentage split (70/15/15) for year_filter=[2024]
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Split sizes: train=700, val=150, test=150
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Scaling features with RobustScaler (robust to outliers)...
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Feature scaling complete: mean=-0.3567, std=4.8786
2025-12-17 21:12:29 - ml.src.pipeline_stages - INFO - Training XGBoost classifier...
2025-12-17 21:12:29 - ml.src.training.sequence_xgb_trainer - INFO - Class balance (train): pos=398, neg=302, imbalance_ratio=0.76
2025-12-17 21:12:29 - ml.src.training.sequence_xgb_trainer - INFO - Applied scale_pos_weight=0.7588 to handle class imbalance
2025-12-17 21:12:29 - ml.src.training.sequence_xgb_trainer - INFO - Training XGBoost classifier...
2025-12-17 21:12:35 - ml.src.training.sequence_xgb_trainer - INFO - Training completed
2025-12-17 21:12:35 - ml.src.pipeline_stages - INFO - Evaluating model on test set...
2025-12-17 21:12:35 - ml.src.training.sequence_evaluation - INFO - Probability stats: min=0.2014, max=0.9051, mean=0.5698, std=0.1733
2025-12-17 21:12:35 - ml.src.training.sequence_evaluation - WARNING - No threshold met precision >= 0.85 with >= 25 trades. Falling back to maximizing precision with stability constraint.
2025-12-17 21:12:35 - ml.src.training.sequence_evaluation - INFO - Confusion matrix@thr=0.72:
2025-12-17 21:12:35 - ml.src.training.sequence_evaluation - INFO -   [[TN=55, FP=5],
2025-12-17 21:12:35 - ml.src.training.sequence_evaluation - INFO -    [FN=62, TP=28]]
2025-12-17 21:12:35 - ml.src.pipeline_stages - INFO - Evaluation metrics: threshold=0.72, win_rate=0.8485 (84.85%), precision=0.8485, recall=0.3111, f1=0.4553, roc_auc=0.6883, pr_auc=0.7548
2025-12-17 21:12:35 - ml.src.pipeline_stages - INFO - Saving artifacts...
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Saved model to sequence_xgb_model.pkl
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Saved scaler to sequence_scaler.pkl (required for inference)
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Saved feature columns to sequence_feature_columns.json
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Saved metadata to sequence_threshold.json
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Analyzing feature importance...
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO - 
Top 30 most important features:
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    1. t-4_rsi_m60                              = 0.005529
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    2. t-2_dist_sma_20_m5                       = 0.005183
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    3. t-3_bb_pos_m15                           = 0.004889
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    4. t-2_bb_pos_m15                           = 0.004869
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    5. t-1_bb_pos_m15                           = 0.004480
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    6. t-9_rsi_m15                              = 0.004241
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    7. t-56_atr_14                              = 0.004171
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    8. t-15_bb_pos_m60                          = 0.003982
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -    9. t-1_dist_sma_20_m15                      = 0.003887
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   10. t-20_dist_sma_20_m5                      = 0.003833
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   11. t-2_dist_sma_20_m15                      = 0.003771
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   12. t-10_bb_position                         = 0.003770
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   13. t-25_rsi_14                              = 0.003709
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   14. t-4_dist_sma_20_m15                      = 0.003639
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   15. t-3_macd_hist_m5                         = 0.003443
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   16. t-52_dist_sma_20_m15                     = 0.003291
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   17. t-6_dist_sma_20_m15                      = 0.003241
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   18. t-51_macd_hist_m5                        = 0.003227
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   19. t-2_rsi_14                               = 0.003221
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   20. t-18_bb_pos_m60                          = 0.003188
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   21. t-56_bb_pos_m60                          = 0.003168
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   22. t-24_dist_sma_20_m5                      = 0.003168
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   23. t-5_bb_pos_m60                           = 0.003124
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   24. t-31_bb_pos_m15                          = 0.003119
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   25. t-11_atr_14                              = 0.003115
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   26. t-4_rsi_14                               = 0.003020
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   27. t-4_dist_sma_20_m5                       = 0.003007
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   28. t-47_rsi_m5                              = 0.002987
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   29. t-8_dist_sma_20_m5                       = 0.002905
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   30. t-6_rsi_14                               = 0.002899
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO - 
Aggregated importance by feature type:
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20_m15                = 0.094833
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   rsi_14                         = 0.088094
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20                    = 0.085391
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   bb_position                    = 0.083388
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   ret_1                          = 0.081050
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   macd_hist_m5                   = 0.080116
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   dist_sma_20_m5                 = 0.077386
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   atr_14                         = 0.076880
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   bb_pos_m15                     = 0.072936
2025-12-17 21:12:35 - ml.src.training.sequence_feature_analysis - INFO -   bb_pos_m5                      = 0.070342
2025-12-17 21:12:35 - ml.src.training.sequence_artifacts - INFO - Saved feature importance to sequence_feature_importance.json
2025-12-17 21:12:35 - ml.src.pipeline_stages - INFO - Artifacts saved to C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 21:12:35 - __main__ - INFO - 
================================================================================
2025-12-17 21:12:35 - __main__ - INFO - TRAINING COMPLETE - SUMMARY
2025-12-17 21:12:35 - __main__ - INFO - ================================================================================
2025-12-17 21:12:35 - __main__ - INFO - End time: 2025-12-17 21:12:35
2025-12-17 21:12:35 - __main__ - INFO - 
Final Metrics:
2025-12-17 21:12:35 - __main__ - INFO -   Window Size:       60 candles
2025-12-17 21:12:35 - __main__ - INFO -   Threshold:         0.7150
2025-12-17 21:12:35 - __main__ - INFO -   WIN RATE:          0.8485 (84.85%)
2025-12-17 21:12:35 - __main__ - INFO -   Precision:         0.8485
2025-12-17 21:12:35 - __main__ - INFO -   Recall:            0.3111
2025-12-17 21:12:35 - __main__ - INFO -   F1 Score:          0.4553
2025-12-17 21:12:35 - __main__ - INFO -   ROC-AUC:           0.6883
2025-12-17 21:12:35 - __main__ - INFO -   PR-AUC:            0.7548
2025-12-17 21:12:35 - __main__ - INFO - 
Artifacts saved to: C:\Users\Arek\Documents\Repos\Traiding\Trading-ML\ml\outputs\models
2025-12-17 21:12:35 - __main__ - INFO - ================================================================================
